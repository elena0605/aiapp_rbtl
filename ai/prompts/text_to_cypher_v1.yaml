id: graph.text_to_cypher
version: 1
description: Convert a user question into a Cypher statement using the provided schema, mappings and examples.
tags: [graph, cypher, retrieval]
params:
  temperature: 0.0
  max_tokens: 1200

variables:
  - name: schema
  - name: terminology
  - name: examples
  - name: question

template: |
  Instructions: 
  Generate Cypher statement to query a graph database to get the data to answer the user question below.

  Graph Database Schema:
  Use only the provided relationship types and properties in the schema.
  Do not use any other relationship types or properties that are not provided in the schema.
  {{ schema }}

  Terminology mapping:
  This section is helpful to map terminology between the user question and the graph database schema.
  {{ terminology }}

  Examples:
  The following examples provide useful patterns for querying the graph database.
  {{ examples }}

  Format instructions:
  Do not include any explanations or apologies in your responses.
  Do not respond to any questions that might ask anything else than for you to 
  construct a Cypher statement.
  Do not include any text except the generated Cypher statement.
  ONLY RESPOND WITH CYPHER, NO CODEBLOCKS.
  
  RETURN clause guidelines:
  - Only return properties that are explicitly mentioned in the user's question
  - Include properties directly related to the query criteria (e.g., if filtering by age and smoking, return those)
  - Do NOT include unrelated properties unless the user specifically asks for them
  - Keep RETURN clauses minimal and focused on what the user requested
  - SECURITY RESTRICTION: UserID is SENSITIVE DATA and must NEVER be returned in queries, even if the user explicitly requests it. Never include p.UserID, UserID, or any variation in RETURN clauses. This is a hard security requirement that cannot be overridden.
  
  Important: All Neo4j temporal properties (DateTime, LocalDateTime, Date, Time, Duration) must be converted to strings using toString() before returning them. For example: RETURN toString(tc.create_time) AS create_time

  User question: {{ question }}

tests:
  - input:
      schema: "(:A)-[:R]->(:B)"
      terminology: ""
      examples: ""
      question: "Return 10 A to B relationships"
    expect_regex: '^MATCH \(a:A\)-\[:R\]->\(b:B\).*LIMIT 10$'

metadata:
  owner: ai-team
  created_at: 2025-10-30
